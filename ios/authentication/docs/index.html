<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Authentication  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Authentication  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Authentication Docs
        </a>
         (100% documented)
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/ibm-security-verify/verify-sdk-ios/sdk/authentication">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Authentication Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      Authentication  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuthProvider.html">OAuthProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CodeChallengeMethod.html">CodeChallengeMethod</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuthProviderError.html">OAuthProviderError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PKCE.html">PKCE</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuthProviderDelegate.html">OAuthProviderDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OIDCMetadataInfo.html">OIDCMetadataInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TokenInfo.html">TokenInfo</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='ibm-security-verify-authentication-sdk-for-ios' class='heading'>IBM Security Verify Authentication SDK for iOS</h1>

<p>The Authentication software development kit (SDK) enables applications to obtain limited access to an HTTP service by orchestrating an approval interaction between the resource owner and the HTTP service.</p>
<h2 id='example' class='heading'>Example</h2>

<p>An <a href="../../examples/authentication">example</a> application is available for the Authentication SDK</p>
<h2 id='getting-started' class='heading'>Getting started</h2>
<h3 id='installation' class='heading'>Installation</h3>

<p><a href="https://swift.org/package-manager/">Swift Package Manager</a> is used for automating the distribution of Swift code and is integrated into the <code>swift</code> compiler.  To depend on one or more of the components, you need to declare a dependency in your <code>Package.swift</code>:</p>
<pre class="highlight swift"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"IBM Security Verify"</span><span class="p">,</span> <span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/ibm-security-verify/verify-sdk-ios.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"3.0.3"</span><span class="p">)</span>
<span class="p">]</span>
</code></pre>

<p>then in the <code>targets</code> section of the application/library, add one or more components to your <code>dependencies</code>, for example:</p>
<pre class="highlight swift"><code><span class="c1">// Target for Swift 5.2</span>
<span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"MyExampleApp"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">product</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Authentication"</span><span class="p">,</span> <span class="nv">package</span><span class="p">:</span> <span class="s">"IBM Security Verify"</span><span class="p">)</span>
<span class="p">],</span>
</code></pre>

<p>Alternatively, you can add the package manually.</p>

<ol>
<li>Select your application project in the <strong>Project Navigator</strong> to display the configuration window.</li>
<li>Select your application project under the <strong>PROJECT</strong> heading</li>
<li>Select the <strong>Swift Packages</strong> tab.</li>
<li>Click on the <code>+</code> button.</li>
<li>Enter <code>https://github.com/ibm-security-verify/verify-sdk-ios.git</code> as the respository URL and follow the remaining steps selecting the components to add to your project.</li>
</ol>
<h3 id='api-documentation' class='heading'>API documentation</h3>

<p>The Authentication SDK API can be reviewed <a href="https://ibm-security-verify.github.io/ios/authentication/docs/">here</a>.</p>
<h3 id='importing-the-sdk' class='heading'>Importing the SDK</h3>

<p>Add the following import statement to the <code>.swift</code> files you want to reference the Authentication SDK.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Authentication</span>
</code></pre>
<h2 id='usage' class='heading'>Usage</h2>
<h3 id='getting-openid-configuration-metadata' class='heading'>Getting OpenId Configuration Metadata</h3>

<p>Discover the authorization service configuration from a compliant OpenID Connect endpoint.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/.well-known/openid-configuration"</span><span class="p">)</span><span class="o">!</span>

<span class="kt">OAuthProvider</span><span class="o">.</span><span class="nf">discover</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='authorization-code-flow-azn' class='heading'>Authorization Code Flow (AZN)</h3>

<p>Authorization code flow is obtained by using an authorization server as an intermediary between the client and resource owner.  The code can later be exchanged for an access token and refresh token.  Refer to <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1">Authorization Code Grant</a> for more information.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Authentication</span>
<span class="kd">import</span> <span class="kt">AuthenticationServices</span> 

<span class="c1">// The view controller to start user authentication.</span>
<span class="kd">class</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">issuerUrl</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/authorize"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">tokenURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/token"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">redirectUrl</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"verifysdk://auth/callback"</span><span class="p">)</span><span class="o">!</span>

    <span class="kd">func</span> <span class="nf">onSigninClick</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">provider</span> <span class="o">=</span> <span class="kt">OAuthProvider</span><span class="p">(</span><span class="nv">clientId</span><span class="p">:</span> <span class="s">"a1b2c3d4"</span><span class="p">)</span>
        <span class="n">provider</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>

        <span class="c1">// Pass additional options like state and preserve the browser session if required.</span>
        <span class="n">provider</span><span class="o">.</span><span class="nf">authorizeWithBrowser</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">issuerURL</span><span class="p">,</span>
            <span class="nv">redirectUrl</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">redirectURL</span><span class="p">,</span>
            <span class="nv">presentingViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - ASWebAuthenticationPresentationContextProviding</span>
<span class="kd">extension</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">ASWebAuthenticationPresentationContextProviding</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">presentationAnchor</span><span class="p">(</span><span class="k">for</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">ASWebAuthenticationSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ASPresentationAnchor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">ASPresentationAnchor</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - OAuthProviderDelegate</span>
<span class="kd">extension</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">OAuthProviderDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">oauthProvider</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OAuthProvider</span><span class="p">,</span> <span class="n">didCompleteWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">oauthProvider</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OAuthProvider</span><span class="p">,</span> <span class="n">didCompleteWithCode</span> <span class="nv">result</span><span class="p">:</span> <span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">String</span><span class="p">?))</span> <span class="p">{</span>

        <span class="c1">// Exchange the authorization code for an access token.</span>
        <span class="n">provider</span><span class="o">.</span><span class="nf">authorize</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">tokenURL</span><span class="o">!</span><span class="p">,</span> <span class="nv">redirectUrl</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">redirectURL</span><span class="p">,</span> <span class="nv">authorizationCode</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>

            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">token</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"save </span><span class="se">\(</span><span class="n">token</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='authorization-code-flow-azn-with-pkce' class='heading'>Authorization Code Flow (AZN) with PKCE</h3>

<p>PKCE enhances the authorization code flow by introducing a secret created by the calling application that can be verified by the authorization server.  The secret, called the Code Verifier is hashed by the calling application into a Code Challenge; it is this value that is send to the authorization server.  A malicious attacker can only intercept the Authorization Code, but cannot exchange it for an access token without the Code Verifier.  The code can later be exchanged for an access token and refresh token.  Refer to <a href="https://datatracker.ietf.org/doc/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a> for more information.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Authentication</span>
<span class="kd">import</span> <span class="kt">AuthenticationServices</span> 

<span class="c1">// The view controller to start user authentication.</span>
<span class="kd">class</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">issuerUrl</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/authorize"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">tokenURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/token"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">redirectUrl</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"verifysdk://auth/callback"</span><span class="p">)</span><span class="o">!</span>
    <span class="k">var</span> <span class="nv">codeVerifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">codeChallenge</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kd">func</span> <span class="nf">onSigninClick</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">provider</span> <span class="o">=</span> <span class="kt">OAuthProvider</span><span class="p">(</span><span class="nv">clientId</span><span class="p">:</span> <span class="s">"a1b2c3d4"</span><span class="p">)</span>
        <span class="n">provider</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>

        <span class="c1">// Generate the code verifier and challenge</span>
        <span class="k">self</span><span class="o">.</span><span class="n">codeVerifier</span> <span class="o">=</span> <span class="kt">PKCE</span><span class="o">.</span><span class="nf">generateCodeVerifier</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">codeChallenge</span> <span class="o">=</span> <span class="kt">PKCE</span><span class="o">.</span><span class="nf">generateCodeChallenge</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">codeVerifier</span><span class="o">!</span><span class="p">)</span>

        <span class="c1">// Pass additional options like state and preserve the browser session if required.</span>
        <span class="n">provider</span><span class="o">.</span><span class="nf">authorizeWithBrowser</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">issuerURL</span><span class="p">,</span>
            <span class="nv">redirectUrl</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">redirectURL</span><span class="p">,</span>
            <span class="nv">presentingViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">codeChallenge</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">codeChallenge</span><span class="p">,</span>
            <span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="kt">S256</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - ASWebAuthenticationPresentationContextProviding</span>
<span class="kd">extension</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">ASWebAuthenticationPresentationContextProviding</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">presentationAnchor</span><span class="p">(</span><span class="k">for</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">ASWebAuthenticationSession</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ASPresentationAnchor</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">ASPresentationAnchor</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - OAuthProviderDelegate</span>
<span class="kd">extension</span> <span class="kt">SigninViewController</span><span class="p">:</span> <span class="kt">OAuthProviderDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">oauthProvider</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OAuthProvider</span><span class="p">,</span> <span class="n">didCompleteWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">oauthProvider</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OAuthProvider</span><span class="p">,</span> <span class="n">didCompleteWithCode</span> <span class="nv">result</span><span class="p">:</span> <span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">String</span><span class="p">?))</span> <span class="p">{</span>

        <span class="c1">// Exchange the authorization code for an access token with the code verifier.</span>
        <span class="n">provider</span><span class="o">.</span><span class="nf">authorize</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">tokenURL</span><span class="o">!</span><span class="p">,</span> 
            <span class="nv">redirectUrl</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">redirectURL</span><span class="p">,</span> 
            <span class="nv">authorizationCode</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
            <span class="nv">codeVerifier</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">codeVerifier</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>

            <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">token</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"save </span><span class="se">\(</span><span class="n">token</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='basic-resource-owner-password-credentials-ropc-grant' class='heading'>Basic Resource Owner Password Credentials (ROPC) grant</h3>

<p>Obtaining a token based on a username and password.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/token"</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// Optionally add additional parameters to the request.</span>
<span class="k">let</span> <span class="nv">provider</span> <span class="o">=</span> <span class="kt">OAuthProvider</span><span class="p">(</span><span class="nv">clientId</span><span class="p">:</span> <span class="s">"a1b2c3"</span><span class="p">,</span> <span class="nv">additionalParameters</span><span class="p">:</span> <span class="p">[</span><span class="s">"pet"</span><span class="p">:</span> <span class="s">"dog"</span><span class="p">,</span> <span class="s">"food"</span><span class="p">:</span> <span class="s">"pizza"</span><span class="p">])</span>

<span class="c1">// Pass in optional scopes.</span>
<span class="n">provider</span><span class="o">.</span><span class="nf">authorize</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">username</span><span class="p">:</span> <span class="s">"testuser"</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span> <span class="nv">scope</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"age"</span><span class="p">])</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='refreshing-a-token' class='heading'>Refreshing a Token</h3>

<p>Refresh tokens are issued to the client by the authorization server and are used to obtain a new access token when the current access token becomes invalid or expires, or to obtain additional access tokens with identical or narrower scope.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.example.com/token"</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// Optionally add additional parameters to the request.</span>
<span class="k">let</span> <span class="nv">provider</span> <span class="o">=</span> <span class="kt">OAuthProvider</span><span class="p">(</span><span class="nv">clientId</span><span class="p">:</span> <span class="s">"a1b2c3"</span><span class="p">)</span>

<span class="c1">// Where `token` was previously obtained through an AZN code or ROPC flow.</span>
<span class="n">provider</span><span class="o">.</span><span class="nf">refresh</span><span class="p">(</span><span class="nv">issuer</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">refreshToken</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">refreshToken</span><span class="o">!</span><span class="p">,</span> <span class="nv">scope</span><span class="p">:</span> <span class="p">[</span><span class="s">"name"</span><span class="p">])</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">value</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='decoding-the-id-token-claims' class='heading'>Decoding the ID Token Claims</h3>

<p>The ID token is an artifact that proves that the user has been authenticated introduced by <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">OpenID Connect (OIDC)</a>.  The ID token is obtained when <code>openid</code> is part of the scope in your authorization request.</p>

<p>The ID token is represented as a sequence of URL-safe parts separated by period (&lsquo;.&rsquo;) characters.  Each part contains a base64url encoded string, for example:</p>

<p><code>{header}.{claims}.{signature}</code></p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">base64UrlEncodedStringWithPadding</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">value</span> <span class="o">=</span> <span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"-"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"+"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"_"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"/"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">count</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">value</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="nv">repeating</span><span class="p">:</span> <span class="s">"="</span><span class="p">,</span> <span class="nv">count</span><span class="p">:</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">value</span><span class="o">.</span><span class="n">count</span> <span class="o">%</span> <span class="mi">4</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">value</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jwt</span> <span class="o">=</span> <span class="s">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"</span>

<span class="c1">// CLaims is the second element of data in the string.</span>
<span class="k">let</span> <span class="nv">claims</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="s">"."</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">base64Encoded</span><span class="p">:</span> <span class="n">claims</span><span class="o">.</span><span class="n">base64UrlEncodedStringWithPadding</span><span class="p">),</span> <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>NOTE: Best practice is to validate the claims against the signature before relying on them for other verifications. 3rd party libraries like <a href="https://github.com/Kitura/Swift-JWT">SwiftJWT</a> can provide the verification and decoding of the ID token.</p>
<h2 id='license' class='heading'>License</h2>

<p>This package contains code licensed under the MIT License (the &ldquo;License&rdquo;). You may view the License in the <a href="https://github.com/ibm-security-verify/verify-sdk-ios/LICENSE">LICENSE</a> file within this package.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2022 <a class="link" href="https://www.ibm.com/au-en/security/identity-access-management" target="_blank" rel="external noopener">IBM Secuity</a>. All rights reserved. (Last updated: 2022-03-21)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.1</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
